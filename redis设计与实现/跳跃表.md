# 跳跃表
跳跃表是一种有序数据结构，它通过在每个节点维持多个指向其他节点的指针，从而达到快速访问节点的目的
跳跃表支持平均O(logN)、最坏O(N)复杂度的节点查找，还可以通过顺序性操作来批量处理节点
大部分情况下，跳跃表的效率可以和平衡树相媲美，并且因为跳跃表的实现比平衡树要简单，所以有不少程序使用跳跃表代替平衡树
Redis使用跳跃表作为有序集合键的底层实现之一，如果一个有序集合包含的元素数量比较多，又或者有序集合中元素的成员是较长的字符串时，Redis就会使用跳跃表作为有序集合键的底层实现
tips: 和链表、字典等数据结构呗广泛的应用在Redis内部不同，Redis只在两个地方用到了跳跃表，一个是实现有序集合键，另一个是在集群节点中用作内部数据结构，除此之外，跳跃表在Redis中没有其他用途

## 跳跃表的实现
Redis的跳跃表由zskiplistNode和zskiplist两个结构定义，其中zskiplistNode结构用于表示跳跃表节点，而zskiplist结构则用于保存跳跃表节点的相关信息，比如节点的数量，以及指向表头和表尾节点的指针等

### zskiplist
1.  header // 指向跳跃表头的节点
2.  tail // 指向跳跃表尾的节点
3.  level // 记录目前跳跃表中，层数最大的那个节点的层数(表头节点的层数不计算在内)
4.  length // 记录跳跃表的长度，也就是跳跃表包含节点的数量(表头节点不计算在内)

### zskiplistNode
1.  level(层) // 节点用L1, L2等标记节点的各个层，L1代表第一层以此类推。每层都带有两个属性：前进指针和跨度。当程序从表头向表尾遍历时，访问会沿着层的前进指针进行
    1.1.  前进指针：前进指针用于访问位于表尾方向的其他节点
    1.2.  跨度：跨度记录了前进指针所指向节点和当前节点的距离
2.  backward(后退指针) // 节点中用BW字样标记节点后退指针，它指向位于当前节点的前一个节点。后退指针在程序从表尾向表头遍历时使用 
3.  score(分值) // 各个节点中1.0、2.0是节点所保存的分值。在跳跃表中，节点按各自所保存的分值从小到大排列
4.  obj(成员对象) // 各个节点中o1、o2是节点所保存的成员对象
注意表头节点和其他节点构造是一样的，只是不会使用到

### 跳跃表节点zskiplistNode
1.  zskiplistLevel {
    1.1.  zskiplistNonde *forward // 前进指针
    1.2.  int span // 跨度
} level[]
2.  zskiplistNonde *backward // 后退指针
3.  double sorce // 分值
4.  robj *obj // 成员对象

#### 层
跳跃表节点的level数组可以包含多个元素，每个元素都包含一个指向其他节点的指针，程序可以通过这些层来加快访问其他节点的速度，一般层数越多，访问其他节点的速度就越快
创建一个新跳跃表节点的时候，根据幂次定律(越大的数出现的概率越小)，随机生成一个介于1和32之间的值作为level数组的大小，这个大小就是层的"高度"

#### 前进指针
每个层都有一个只想表尾方向的前进指针，用于从表头向表尾方向访问节点

#### 跨度
用于记录两个节点之前的距离
实际上遍历操作只使用前进指针就可以完成了，跨度实际上是用来计算排位的：在查找某个节点的过程中，将沿途访问过的所有层的跨度累计起来，得到的结果就是目标节点在跳跃表中的排位

#### 后退指针
用于从表尾向表头访问节点：跟可以一次跳过多个节点的前进指针不同，因为每个节点只有一个后退指针，所以每次只能后退至前一个节点

#### 分值和成员
分值：Double类型的浮点数，跳跃表中所有节点都按分值从小到大排序
成员对象：一个指向字符串对象的指针，而字符串对象则保存着一个SDS值
同一个跳跃表中，各个节点保存的成员对象必须是唯一的，但是多个节点保存的分值可以相同：分值相同的节点将按照成员对象在字典序的大小来进行排序(正序)

### 跳跃表
仅靠多个跳跃表节点即可组成一个跳跃表

#### zskiplist
1.  zskiplistNode *header, *tail // 表头表尾节点
2.  long length // 表中节点数量(不计算表头节点)
3.  int level // 表中层数最大的节点层数(不计算表头节点)
但是通过zskplist结构来持有这些节点，程序可以更方便地对整个跳跃表进行处理，比如快速访问跳跃表的表头和表尾节点，或者快速获取跳跃表节点的数量

## 重点回顾
1.  跳跃表是有序集合的底层实现之一
2.  Redis的跳跃表实现由zskiplist和zskiplistNode两个结构组成，其中zskiplist用于保存跳跃表信息(表头表尾节点长度等)，而zskiplistNode则用于表示跳跃表节点
3.  每个跳跃表节点的层高都是1至32的随机数
4.  在同一个跳跃表中，多个节点可以包含相同的分数，但每个节点的成员对象必须是唯一的
5.  跳跃表的节点按照分值大小进行排序，当分值相同时，节点按照成员对象的的字符集大小进行排序