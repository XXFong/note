# 整数集合
整数集合是集合键的底层实现之一，当一个集合只包含整数值元素，并且这个集合的元素数量不多时，Redis就会使用整数集合作为集合键的底层实现

## 整数集合(intsets)的实现
整数集合是Redis用于保存整数值得集合抽象数据结构，它可以保存类型为int16_t、int32_t、int64_t的整数值，并且保证集合中不会出现重复元素
1.  uint32_t coding // 编码方式
2.  uint32_t length // 集合包含的元素数量
3.  int8_t contents[] // 保存元素的数组

contents数组是整数集合和底层实现：整数集合的每个元素都是contents数组的一个数组项(item)，各个项在数组中按值的大小从小到大有序地排列，并且数组中不含任何重复项
length属性记录了整数集合包含的元素数量，也即是contents数组的长度
虽然intsets结构将contents属性声明为int8_t类型的数组，但实际上contents数组并不保存任何int8_t类型的值，contents数组的真正类型取决于encoding属性的值

## 升级
每当我们要将一个新元素添加到整数集合中，并且新元素的类型比整数集合现有元素的类型都要长时，需要先进行升级，然后才能将新元素添加到整数集合里面
1.  根据新元素的类型，扩展整数集合底层数组的空间大小，并为新元素分配空间
2.  将底层数组现有的所有元素都转换成与新元素相同的类型，并将类型转换后的元素放到正确的位置上，放置元素的过程中，需要继续维持底层数组的有序性质不变
3.  将新元素添加到底层数组里面
因为每次向整数集合添加新元素都可能会引起升级，而每次升级都需对底层数组中的已有的元素进行类型转换，所以向整数集合添加新元素的时间复杂度为O(N)

## 升级的好处
一个是提升整数集合的灵活性，另一个是尽可能地节约内存

### 提升灵活性
因为C语言是静态类型语言，为了避免类型错误，我们通常不会将两种不同类型的值放在同一个数据结构里面，因为自动升级的存在，可以随意将不同int类型的整数添加到集合中，而不必担心出现类型错误

### 节约内存
现在整数集合的做法即可让集合同时保存三种不同类型的值，又可以确保升级操作只会在有需要的时候进行，这可以尽量节省内存、

## 降级
整数集合不支持降级，一旦对数组进行了升级，编码就会一直保持升级后的状态

## 重点回顾
1.  整数集合是集合键的底层实现之一
2.  整数集合的底层实现为数组，这个数组以有序、无重复的方式保存集合元素，在有需要的时候，程序会根据添加元素的类型，改变这个数组的类型
3.  升级操作为整数集合带来了操作上的灵活性，并且尽可能地节约了内存
4.  整数集合只支持升级操作，不支持降级操作